{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script src="https://cdn.jsdelivr.net/npm/mermaid@8.8.4/dist/mermaid.min.js"></script>
  <script>
    function renderMermaidBlocks() {
      mermaid.initialize({ startOnLoad: false });

      const blocks = document.querySelectorAll("pre code.language-mermaid");
      blocks.forEach((block) => {
        const pre = block.closest("pre");
        const div = document.createElement("div");
        div.className = "mermaid";
        div.textContent = block.textContent;
        pre.replaceWith(div);
      });

      mermaid.init(undefined, document.querySelectorAll(".mermaid"));
    }

    // Material theme may delay loading: hook into page transitions
    document.addEventListener("DOMContentLoaded", () => {
      if (window.mermaid) {
        renderMermaidBlocks();
      }

      // Re-render on MkDocs Material page navigation
      if (window.mutationObserverMermaidFix) return;  // prevent duplicates
      window.mutationObserverMermaidFix = true;

      const observer = new MutationObserver((mutations) => {
        mutations.forEach(() => {
          renderMermaidBlocks();
        });
      });

      observer.observe(document.querySelector("main"), { childList: true, subtree: true });
    });
  </script>
{% endblock %}
