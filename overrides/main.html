{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script src="https://cdn.jsdelivr.net/npm/mermaid@8.8.4/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: false });

    document.addEventListener("DOMContentLoaded", function () {
      // Busca bloques Mermaid envueltos en <pre><code>
      const mermaidBlocks = document.querySelectorAll("pre code.language-mermaid");

      mermaidBlocks.forEach((block, index) => {
        const pre = block.closest("pre");
        const wrapper = document.createElement("div");
        wrapper.classList.add("mermaid");

        // Decode HTML entities (&gt; â†’ >, etc.)
        const html = block.innerHTML
          .replace(/&gt;/g, '>')
          .replace(/&lt;/g, '<')
          .replace(/&amp;/g, '&');

        wrapper.innerHTML = html;

        // Reemplaza el <pre> por el <div class="mermaid">
        pre.parentNode.replaceChild(wrapper, pre);
      });

      mermaid.init(undefined, document.querySelectorAll(".mermaid"));
    });
  </script>
{% endblock %}
