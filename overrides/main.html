{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script src="https://cdn.jsdelivr.net/npm/mermaid@8.8.4/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      mermaid.initialize({ startOnLoad: false });

      const blocks = document.querySelectorAll("pre code.highlight");

      blocks.forEach((block, i) => {
        const pre = block.closest("pre");

        // Crear nuevo contenedor mermaid
        const container = document.createElement("div");
        container.className = "mermaid";

        // Obtener texto plano (m√°s seguro que innerHTML)
        const code = block.textContent || block.innerText;

        // Pegarlo directamente
        container.textContent = code;

        // Reemplazar el <pre> por <div class="mermaid">
        pre.replaceWith(container);
      });

      // Renderizar todo
      mermaid.init(undefined, document.querySelectorAll(".mermaid"));
    });
  </script>
{% endblock %}
